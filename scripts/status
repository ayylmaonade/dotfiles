#!/bin/bash

# Arch Linux Repository Status Checker
# Save as: status
# Install: sudo install -m 755 status /usr/local/bin/

# Colors for output (if terminal supports it)
if [ -t 1 ]; then
    GREEN='\033[0;32m'
    RED='\033[0;31m'
    YELLOW='\033[1;33m'
    NC='\033[0m' # No Color
else
    GREEN=''
    RED=''
    YELLOW=''
    NC=''
fi

# Check function with timeout
check_service() {
    local name="$1"
    local url="$2"
    local timeout="5"
    
    echo -n "Checking ${name}... "
    
    # Use curl to check HTTP status with timeout
    http_code=$(curl -s -o /dev/null -w "%{http_code}" --max-time "$timeout" "$url" 2>/dev/null)
    
    if [ "$http_code" = "200" ]; then
        echo -e "${GREEN}ONLINE${NC}"
        return 0
    elif [ -z "$http_code" ]; then
        echo -e "${RED}TIMEOUT${NC}"
        return 1
    else
        echo -e "${RED}OFFLINE (HTTP $http_code)${NC}"
        return 1
    fi
}

# Main execution
echo "=== Arch Linux Repository Status ==="
echo "Checked at: $(date '+%Y-%m-%d %H:%M:%S')"
echo

# Check official Arch mirrors
check_service "Official Repos (archlinux.org)" "https://archlinux.org/mirrorlist/"

# Check AUR
check_service "AUR (aur.archlinux.org)" "https://aur.archlinux.org/"

# Check infrastructure status page for additional info
echo
echo -e "${YELLOW}For detailed infrastructure status, visit:${NC}"
echo -e "${YELLOW}  https://status.archlinux.org/${NC}"
echo "====================================="
